<!DOCTYPE html>
<html lang="en" ng-app="app">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="author" content="Daniel Rodriguez">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <title>Extracting NBA data from ESPN | Daniel Rodriguez</title>

        <link rel="alternate" type="application/atom+xml" title="Daniel Rodriguez blog atom feed" href="/feeds/all.atom.xml" />
        <link rel="stylesheet" href="/theme/css/normalize.min.css">
        <link rel="stylesheet" href="/theme/css/fonts/proximanova.css">
        <link rel="stylesheet" href="/theme/css/fonts/ss-social.css">
        <link rel="stylesheet" href="/theme/css/fonts/ss-standard.css">
        <link rel="stylesheet" href="/theme/css/pygments.css">
        <link rel="stylesheet" href="/theme/css/main.css">

        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script>
    </head>

    <body ng-controller="MainCtrl">
        <div class="header">
            <div class="navbar">
                <a href="/" class="ss-icon" title="home">home</a>
                <a href="/tags.html" class="ss-icon" title="tags">tag</a>
                
                                    <a href="http://twitter.com/danielfrg" class="ss-icon ss-social" title="on twitter">twitter</a>
                
                                <a href="http://github.com/danielfrg" class="ss-icon ss-social" title="on github">octocat</a>
                
                                <a href="/feeds/all.atom.xml" class="ss-icon ss-social" title="rss feed">rss</a>
                
                                <a href="mailto:df.rodriguez143@gmail.com" class="ss-icon" title="email me">mail</a>
                            </div>
        </div>

        <div id="content">
            <div class="post">
    <article>
        <header>
            <h1>Extracting NBA data from ESPN</h1>
        </header>
        <div class='post-content'>
            <p>I've been wanting to play with some sports data for a while. Today I decide to
stop procastinating and do it. The problems was that after searching a
while (15 minutes) for some data I was unable to find the data I wanted.
Even in the <a href="http://www.databasebasketball.com/">Basktetball Database</a>
(not really sure I undestand the site).</p>
<p>A friend showed me the <a href="http://espn.go.com/nba/">ESPN</a> stats and ask me if I
knew how to scrap the data from a website. I lied and told him Yes.
But I know python and its magic powers so after reading 15 minutes I knew how to do it.</p>
<p>I used <a href="http://docs.python-requests.org/en/latest/">requests</a> and
<a href="http://www.crummy.com/software/BeautifulSoup/">beautifulsoup</a> to download and
scrap the data from the ESPN site. Then used <a href="http://pandas.pydata.org/">pandas</a>
to order, slice, and save the data into simple csv files. Also used
<a href="http://ipython.org/">iPython notebooks</a> to develop the code faster.
And a little bit of my <a href="https://github.com/danielfrg/copper">copper</a>
project to use the data analysis project structure.</p>
<h2>Get the teams</h2>
<p>First I needed to get all the team names and URLs. So is as simple as request
<a href="http://espn.go.com/nba/teams">http://espn.go.com/nba/teams</a> and 32 lines of python.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">copper</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="n">copper</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#39;../../&#39;</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://espn.go.com/nba/teams&#39;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">tables</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;ul&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;medium-logos&#39;</span><span class="p">)</span>

<span class="n">teams</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">prefix_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">prefix_2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">teams_urls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span><span class="p">:</span>
    <span class="n">lis</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;li&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">lis</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">li</span><span class="o">.</span><span class="n">h5</span><span class="o">.</span><span class="n">a</span>
        <span class="n">teams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span>
        <span class="n">teams_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">prefix_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">prefix_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


<span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;url&#39;</span><span class="p">:</span> <span class="n">teams_urls</span><span class="p">,</span> <span class="s">&#39;prefix_2&#39;</span><span class="p">:</span> <span class="n">prefix_2</span><span class="p">,</span> <span class="s">&#39;prefix_1&#39;</span><span class="p">:</span> <span class="n">prefix_1</span><span class="p">}</span>
<span class="n">teams</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">teams</span><span class="p">)</span>
<span class="n">teams</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;team&#39;</span>
<span class="k">print</span><span class="p">(</span><span class="n">teams</span><span class="p">)</span>
<span class="n">copper</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">teams</span><span class="p">,</span> <span class="s">&#39;teams&#39;</span><span class="p">)</span>
</pre></div>


<p>This saves <code>teams.csv</code> file with the 30 teams in this format.</p>
<div class="highlight"><pre><span class="n">team</span><span class="p">,</span><span class="n">prefix_1</span><span class="p">,</span><span class="n">prefix_2</span><span class="p">,</span><span class="n">url</span>
<span class="n">Boston</span> <span class="n">Celtics</span><span class="p">,</span><span class="n">bos</span><span class="p">,</span><span class="n">boston</span><span class="o">-</span><span class="n">celtics</span><span class="p">,</span><span class="n">http</span><span class="o">:</span><span class="c1">//espn.go.com/nba/team/_/name/bos/boston-celtics</span>
<span class="n">Brooklyn</span> <span class="n">Nets</span><span class="p">,</span><span class="n">bkn</span><span class="p">,</span><span class="n">brooklyn</span><span class="o">-</span><span class="n">nets</span><span class="p">,</span><span class="n">http</span><span class="o">:</span><span class="c1">//espn.go.com/nba/team/_/name/bkn/brooklyn-nets</span>
<span class="p">......</span>
</pre></div>


<h2>Get games</h2>
<p>Then I needed the games information. For this is necessary to read the previous
csv file and for each team make a request and parse the data. On this case
60 lines of python produced a 1084 rows csv file with all the games of the current
(2013) season. But is as simple as changing a variable to download other seasons information.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">copper</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span>
<span class="n">copper</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#39;../../&#39;</span>

<span class="n">year</span> <span class="o">=</span> <span class="mi">2013</span>
<span class="n">teams</span> <span class="o">=</span> <span class="n">copper</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&#39;teams.csv&#39;</span><span class="p">)</span>
<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">&#39;http://espn.go.com/nba/team/schedule/_/name/{0}/year/{1}/{2}&#39;</span>

<span class="n">match_id</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">home_team</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">home_team_score</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">visit_team</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">visit_team_score</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">teams</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">_team</span><span class="p">,</span> <span class="n">url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;team&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BASE_URL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;prefix_1&#39;</span><span class="p">],</span> <span class="n">year</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;prefix_2&#39;</span><span class="p">]))</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">table</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c"># Remove header</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;td&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_home</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">li</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s">&#39;vs&#39;</span> <span class="k">else</span> <span class="bp">False</span>
            <span class="n">_other_team</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
            <span class="n">_score</span> <span class="o">=</span> <span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">_won</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s">&#39;W&#39;</span> <span class="k">else</span> <span class="bp">False</span>

            <span class="n">match_id</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">a</span><span class="p">[</span><span class="s">&#39;href&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;?id=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">home_team</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_team</span> <span class="k">if</span> <span class="n">_home</span> <span class="k">else</span> <span class="n">_other_team</span><span class="p">)</span>
            <span class="n">visit_team</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_team</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">_home</span> <span class="k">else</span> <span class="n">_other_team</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s">&#39;%a, %b </span><span class="si">%d</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">day</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">_home</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_won</span><span class="p">:</span>
                    <span class="n">home_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">visit_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">home_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">visit_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_won</span><span class="p">:</span>
                    <span class="n">home_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">visit_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">home_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">visit_team_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_score</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c"># Not all columns row are a match, is OK</span>
            <span class="c"># print(e)</span>

<span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="n">match_id</span><span class="p">,</span> <span class="s">&#39;date&#39;</span><span class="p">:</span> <span class="n">dates</span><span class="p">,</span> <span class="s">&#39;home_team&#39;</span><span class="p">:</span> <span class="n">home_team</span><span class="p">,</span> <span class="s">&#39;visit_team&#39;</span><span class="p">:</span> <span class="n">visit_team</span><span class="p">,</span>
        <span class="s">&#39;home_team_score&#39;</span><span class="p">:</span> <span class="n">home_team_score</span><span class="p">,</span> <span class="s">&#39;visit_team_score&#39;</span><span class="p">:</span> <span class="n">visit_team_score</span><span class="p">}</span>

<span class="n">games</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dic</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="s">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">games</span><span class="p">)</span>
<span class="n">copper</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">games</span><span class="p">,</span> <span class="s">&#39;games&#39;</span><span class="p">)</span>
</pre></div>


<h2>Get player stats</h2>
<p>All the previous data is good but for doing some analysis I need players stats.
Then for each game I download all players stats for that game. The result was
55 lines of python (imports included) to generate 27645 rows full with stats.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">copper</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">date</span>
<span class="n">copper</span><span class="o">.</span><span class="n">project</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#39;../..&#39;</span>

<span class="n">games</span> <span class="o">=</span> <span class="n">copper</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&#39;games.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s">&#39;http://espn.go.com/nba/boxscore?gameId={0}&#39;</span>

<span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BASE_URL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">games</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;table&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;mod-data&#39;</span><span class="p">)</span>
<span class="n">heads</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;thead&#39;</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;th&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="n">th</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;team&#39;</span><span class="p">,</span> <span class="s">&#39;player&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">headers</span>

<span class="n">players</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_players</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="n">team_name</span><span class="p">):</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">players</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">array</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">player</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">players</span><span class="p">):</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;td&#39;</span><span class="p">)</span>
        <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;DNP&#39;</span><span class="p">):</span>
                <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>

    <span class="n">frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">array</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="n">index</span><span class="p">,</span> <span class="n">team_name</span><span class="p">],</span> <span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">columns</span><span class="p">))</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">frame</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">frame</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">games</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">BASE_URL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;table&#39;</span><span class="p">,</span> <span class="n">class_</span><span class="o">=</span><span class="s">&#39;mod-data&#39;</span><span class="p">)</span>
    <span class="n">heads</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;thead&#39;</span><span class="p">)</span>
    <span class="n">bodies</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tbody&#39;</span><span class="p">)</span>

    <span class="n">team_1</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">th</span><span class="o">.</span><span class="n">text</span>
    <span class="n">team_1_players</span> <span class="o">=</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)</span>
    <span class="n">team_1_players</span> <span class="o">=</span> <span class="n">get_players</span><span class="p">(</span><span class="n">team_1_players</span><span class="p">,</span> <span class="n">team_1</span><span class="p">)</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">team_1_players</span><span class="p">)</span>

    <span class="n">team_2</span> <span class="o">=</span> <span class="n">heads</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">th</span><span class="o">.</span><span class="n">text</span>
    <span class="n">team_2_players</span> <span class="o">=</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">bodies</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s">&#39;tr&#39;</span><span class="p">)</span>
    <span class="n">team_2_players</span> <span class="o">=</span> <span class="n">get_players</span><span class="p">(</span><span class="n">team_2_players</span><span class="p">,</span> <span class="n">team_2</span><span class="p">)</span>
    <span class="n">players</span> <span class="o">=</span> <span class="n">players</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">team_2_players</span><span class="p">)</span>

<span class="n">players</span> <span class="o">=</span> <span class="n">players</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">players</span><span class="p">)</span>
<span class="n">copper</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">players</span><span class="p">,</span> <span class="s">&#39;players&#39;</span><span class="p">)</span>
</pre></div>


<p>The file looks like this</p>
<div class="highlight"><pre><span class="p">,</span><span class="n">id</span><span class="p">,</span><span class="n">team</span><span class="p">,</span><span class="n">player</span><span class="p">,</span><span class="n">MIN</span><span class="p">,</span><span class="n">FGM</span><span class="o">-</span><span class="n">A</span><span class="p">,</span><span class="mi">3</span><span class="n">PM</span><span class="o">-</span><span class="n">A</span><span class="p">,</span><span class="n">FTM</span><span class="o">-</span><span class="n">A</span><span class="p">,</span><span class="n">OREB</span><span class="p">,</span><span class="n">DREB</span><span class="p">,</span><span class="n">REB</span><span class="p">,</span><span class="n">AST</span><span class="p">,</span><span class="n">STL</span><span class="p">,</span><span class="n">BLK</span><span class="p">,</span><span class="n">TO</span><span class="p">,</span><span class="n">PF</span><span class="p">,</span><span class="o">+/-</span><span class="p">,</span><span class="n">PTS</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">400277722</span><span class="p">,</span><span class="n">Boston</span> <span class="n">Celtics</span><span class="p">,</span><span class="n">Brandon</span> <span class="n">Bass</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span><span class="mi">15</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">400277722</span><span class="p">,</span><span class="n">Boston</span> <span class="n">Celtics</span><span class="p">,</span><span class="n">Paul</span> <span class="n">Pierce</span><span class="p">,</span><span class="mi">41</span><span class="p">,</span><span class="mi">6</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span><span class="mi">23</span>
<span class="p">...</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">400277722</span><span class="p">,</span><span class="n">Miami</span> <span class="n">Heat</span><span class="p">,</span><span class="n">Shane</span> <span class="n">Battier</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">+</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">400277722</span><span class="p">,</span><span class="n">Miami</span> <span class="n">Heat</span><span class="p">,</span><span class="n">LeBron</span> <span class="n">James</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">10</span><span class="o">-</span><span class="mi">16</span><span class="p">,</span><span class="mi">2</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">+</span><span class="mi">12</span><span class="p">,</span><span class="mi">26</span>
<span class="mi">0</span><span class="p">,</span><span class="mi">400277722</span><span class="p">,</span><span class="n">Miami</span> <span class="n">Heat</span><span class="p">,</span><span class="n">Chris</span> <span class="n">Bosh</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="mi">8</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">+</span><span class="mi">15</span><span class="p">,</span><span class="mi">19</span>
<span class="p">.....</span> <span class="n">A</span> <span class="n">LOT</span> <span class="n">OF</span> <span class="n">DATA</span> <span class="p">.....</span>
</pre></div>


<h2>Conclusion</h2>
<p>I love python more.</p>
<p>Still a <strong>lot</strong> of work is needed in order to make sense of all that data. But
at least now I have some data.</p>
<p>Next step is probably to insert the data into a <a href="http://www.postgresql.org/">postgres</a>
database. Or just be crazy and do some machine learning as it is.</p>
<p>The data and code is on github <a href="https://github.com/danielfrg/nba">nba</a>.</p>
        </div>
    </article>

    <div class="metadata">
        <ul>
            <li>
                <strong>Published:</strong>
                <i><time datetime="2013-04-01T00:00:00">01.04.2013</time></i>
            </li>
            <li>
                <strong>In:</strong>
                <a href="http://danielfrg.github.io/category/crawling.html">Crawling</a>
            </li>
                        <li>
                <strong>Tags:</strong>
                <a href="http://danielfrg.github.io/tag/python.html">python</a>
                <a href="http://danielfrg.github.io/tag/crawling.html">crawling</a>
                <a href="http://danielfrg.github.io/tag/pandas.html">pandas</a>
                <a href="http://danielfrg.github.io/tag/requests.html">requests</a>
                <a href="http://danielfrg.github.io/tag/beautifulsoup.html">beautifulsoup</a>
                            </li>
                        <li>
                <strong>Written by:</strong>
                <a href="http://danielfrg.github.io/author/daniel-rodriguez.html">Daniel Rodriguez</a>
            </li>
        </ul>
    </div>
</div>
        </div>

        <footer>
                <div class="post social container">
        <div class="span3">
            <div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false"></div>
        </div>
        <div class="span3">
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="danielfrg">Tweet</a>
        </div>

        <div class="span3">
            <div class="g-plusone" data-size="medium" data-annotation="bubble"></div>
        </div>

        <div class="span3 hn">
            <span id="hnews"></span>
        </div>
    </div>

        <div id="disqus_thread" class="comments container"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'danielfrg'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    
<script src="/theme/js/social.js"></script>
        </footer>

        <script src="/theme/js/ngProgress.js"></script>
        <script>
            var app = angular.module('app', ['ngProgress']);

            app.config(function(ngProgressProvider){
                ngProgressProvider.setColor('black');
                ngProgressProvider.setHeight('2px');
            });

            /*
            app.directive("scroll", function ($window) {
                return function(scope, element, attrs) {
                    angular.element($window).bind("scroll", function() {
                        var body = document.body;
                        var html = document.documentElement;

                        var height = Math.max(body.scrollHeight, body.offsetHeight,
                                              html.clientHeight, html.scrollHeight, html.offsetHeight);
                        // scope.updateProgress(this.scrollY / this.window.height);
                        scope.updateProgress(this.scrollY / height);
                        scope.$apply();
                    });
                };
            });
            */

            var MainCtrl = function($scope, $timeout, ngProgress) {
                ngProgress.start();
                $timeout(function(){
                    ngProgress.complete();
                    // ngProgress.set(0);
                }, 2000);

                $scope.updateProgress = function(percent) {
                    ngProgress.set(percent * 100);
                }
            }

        </script>
        
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-35523657-2']);
_gaq.push(['_trackPageview']);

(function() {
var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>

    </body>
</html>