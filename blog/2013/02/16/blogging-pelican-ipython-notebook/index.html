<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <meta name="author" content="Daniel Rodriguez">
    
    <title>Blogging with iPython notebooks in pelican | Daniel Rodriguez</title>

          <link rel="stylesheet" href="/theme/css/assets.49a445d5.css">
              <link rel="stylesheet" href="/theme/css/main.874de893.css">
                                    <link rel="stylesheet" href="/theme/css/pygments.1aae3274.css">
            </head>

<body>

<div class="header">
<div class="navbar">
  <a href="/" class="ss-icon" title="home">home</a>
  <a href="/tags.html" class="ss-icon" title="tags">tag</a>
  <!-- <a href="/archives.html" class="ss-icon" title="archives">notebook</a> -->
  <a href="http://about.me/danielfrg" class="ss-icon" title="about">user</a>
  <a href="http://atdanielfrg.tumblr.com" class="ss-icon ss-social" title="my thoughs on tumblr">tumblr</a>
  <a href="http://twitter.com/danielfrg" class="ss-icon ss-social" title="on twitter">twitter</a>
  <a href="http://github.com/danielfrg" class="ss-icon ss-social" title="on github">octocat</a>
  <a href="mailto:df.rodriguez143@gmail.com" class="ss-icon" title="email me">mail</a>
</div>
</div>

<div class="content">
<div class="post">
    <article>
        <header>
            <h1>Blogging with iPython notebooks in pelican</h1>
        </header>
        <div class='post-content'>
            <p class='update'><strong>Update: </strong> Check out the updated post on <a href="../../../../../blog/2013/03/08/pelican-ipython-notebook-plugin/">blogging with iPython notebook and pelican with a plugin</a>.</p>

<p>It seems that I spend most time redesigning/developing this blog than actually
blogging xD, just a few weeks ago I wrote about how I was <a href="../../../../../blog/2013/01/31/new-blog-using-jekyll-and-ipython/">blogging using jekyll
with iPython notebooks</a>
and now I am talking about doing the same different static blog engine.</p>
<p>The fact is that a few days ago I found <a href="http://www.getpelican.com">pelican</a>, the first serious
python alternative to Jekyll I have found, and after reading 15 minutes about it I was
downloading pelican and creating a theme based on my old Jekyll site.</p>
<p>The switch was easy just needed move some files, change some of the tags from liquid to
<a href="http://jinja.pocoo.org/docs/">jinja2</a> and add some metadata. The fact of having
less than 10 posts also helped because I did that part manually.</p>
<p>The fact that <a href="http://www.getpelican.com">pelican</a> is on python gave me the idea of creating an
automated way of blogging with ipython notebooks, so I dive a little bit into
the <a href="http://docs.getpelican.com/">pelican documentation</a> (which is great) and decide to make it.</p>
<h2>How I did it</h2>
<p><a href="http://www.getpelican.com">Pelican</a> uses what thet call
<a href="http://docs.getpelican.com/en/3.1.1/internals.html#how-to-implement-a-new-reader">readers</a>
to read different formats
(markdown, rst, and now ipynb) and output general HTML so it is very easy to
implement a markup for any language. Also the iPython team has already a
very good <a href="https://github.com/ipython/nbconvert">set of converts</a> so all I did
was to copy and integrate that necessary code.</p>
<p>Finally I took some of the code from Jake Vanderplas when he talks about
<a href="http://jakevdp.github.com/blog/2012/10/04/blogging-with-ipython/">blogging with Octopress and iPython</a>.
The idea is to encapsulate the ipython notebook HTML and CSS so the CSS of
the site don't get messed up.</p>
<h2>How to use it</h2>
<p>I made a <a href="https://github.com/getpelican/pelican/pull/730">pull request</a>
on the official pelican repo but that may take some time so if if you are impatient can use
<a href="https://github.com/danielfrg/pelican/tree/ipythonnb-reader">my forked version (brach: ipythonnb-reader)</a>
or even just made the changes yourself as are just a few.</p>
<p>Before anything install pelican and ipython with <code>pip install pelican ipython</code> also markdown if you want</p>
<p>First, locate the pelican folder: mine is: <code>~/.virtualenvs/blog/lib/python2.7/site-packages/pelican/</code></p>
<p>At beginning of <code>readers.py</code> add this</p>
<div class="codehilite"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">import</span> <span class="nn">IPython</span>
    <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
    <span class="kn">from</span> <span class="nn">util.nbconverter.html</span> <span class="kn">import</span> <span class="n">ConverterHTML</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">IPython</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>


<p>On <code>readers.py</code> just before <code>_EXTENSIONS = {}</code> paste the main reader code</p>
<div class="codehilite"><pre><span class="k">class</span> <span class="nc">IPythonReader</span><span class="p">(</span><span class="n">Reader</span><span class="p">):</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">IPython</span><span class="p">)</span>
    <span class="n">file_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;ipynb&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">converter</span> <span class="o">=</span> <span class="n">ConverterHTML</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">converter</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="n">metadata_uni</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">text</span><span class="p">)[</span><span class="s">&#39;metadata&#39;</span><span class="p">]</span>
        <span class="n">metadata2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Change unicode encoding to utf-8</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata_uni</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
          <span class="n">metadata2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">metadata2</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_metadata</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">[</span><span class="s">&#39;ipython&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">main_body</span><span class="p">()</span> <span class="c"># Use the ipynb converter</span>
        <span class="c"># change ipython css classes so it does not mess up the blog css</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">converter</span><span class="o">.</span><span class="n">main_body</span><span class="p">())</span>
        <span class="c"># replace the highlight tags</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;class=&quot;highlight&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;class=&quot;highlight-ipynb&quot;&#39;</span><span class="p">)</span>
        <span class="c"># specify &lt;pre&gt; tags</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;pre&#39;</span><span class="p">,</span> <span class="s">&#39;&lt;pre class=&quot;ipynb&quot;&#39;</span><span class="p">)</span>
        <span class="c"># create a special div for notebook</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s">&#39;&lt;div class=&quot;ipynb&quot;&gt;&#39;</span> <span class="o">+</span> <span class="n">content</span> <span class="o">+</span> <span class="s">&quot;&lt;/div&gt;&quot;</span>
        <span class="c"># Modify max-width for tables</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;max-width:1500px;&#39;</span><span class="p">,</span> <span class="s">&#39;max-width:650px;&#39;</span><span class="p">)</span>
        <span class="c"># h1,h2,...</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="s">&#39;123456&#39;</span><span class="p">:</span>
          <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;&lt;h</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">h</span><span class="p">,</span> <span class="s">&#39;&lt;h</span><span class="si">%s</span><span class="s"> class=&quot;ipynb&quot;&#39;</span> <span class="o">%</span> <span class="n">h</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="n">metadata</span>
</pre></div>


<p>Second, Create a new folder called <code>util</code> on the pelican directory and then download
the <a href="https://github.com/danielfrg/pelican/tree/ipythonnb-reader/pelican/util">contents of my branch</a>
to that folder.</p>
<p>Now you are ready to blog with the iPython notebooks.</p>
<h2>How to blog</h2>
<p>First, need to update the MARKUP setting on <code>pelicanconf.py</code> to:
<code>MARKUP = ('md', 'ipynb')</code> that way pelican recognizes the <code>ipynb</code> format as an article.</p>
<p>Create you super amazing iPython notebook with charts, markdown, etc and save it to the
<code>content</code> folder of your pelican site.</p>
<p>Open the <code>.ipynb</code> file on your favorite text editor and should see something like this:</p>
<div class="codehilite"><pre><span class="p">{</span>
 <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Super iPython NB&quot;</span>
 <span class="p">},</span>
 <span class="err">{</span> <span class="err">A_LOT_OF_OTHER_STUFF</span> <span class="p">}</span>
</pre></div>


<p>Modify the file to:</p>
<div class="codehilite"><pre><span class="p">{</span>
 <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Super iPython NB&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Title&quot;</span><span class="p">:</span> <span class="s2">&quot;Blogging with iPython notebooks in pelican&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Date&quot;</span><span class="p">:</span> <span class="s2">&quot;2013-2-16&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Category&quot;</span><span class="p">:</span> <span class="s2">&quot;Category&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Tags&quot;</span><span class="p">:</span> <span class="s2">&quot;tag2, tag2&quot;</span><span class="p">,</span>
  <span class="nt">&quot;slug&quot;</span><span class="p">:</span> <span class="s2">&quot;slug-slug-slug&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Author&quot;</span><span class="p">:</span> <span class="s2">&quot;Me&quot;</span>
 <span class="p">},</span>
 <span class="err">{</span> <span class="err">A_LOT_OF_OTHER_STUFF</span> <span class="p">}</span>
</pre></div>


<p>Note that only the title and date tags are actually necessary.</p>
<p>Thats it, couldn't be more simple!</p>
<p>One final thing to do only once is to include the the
<a href="https://github.com/danielfrg/pelican/tree/ipythonnb-reader/pelican/themes/ipythonnb/css">ipython.min.css</a>
in your pelican theme. Since not all posts are going to be in iPython is not
necessary to include the css file on all pages; so to be more efficient
I created a metadata to identify which posts are from ipython notebooks
so you in your pelican <code>article.html</code> template should do:</p>
<div class="codehilite"><pre>{% if article.ipython %}
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;/theme/css/ipython.min.css&quot;</span><span class="nt">&gt;</span>
{% endif %}
</pre></div>


<p>This particular post uses markdown but most of my previous posts are now converted
from ipython notebooks for example: <a href="../../../../../blog/2013/02/13/copper-quick-data-transformation-python/">copper-quick-data-transformation</a></p>
<p>If are curious about my pelican config or theme check it out on <a href="https://github.com/danielfrg/danielfrg.github.com">github</a>.</p>
<p>Happy blogging!</p>
<p class='update'><strong>Update: </strong> Check out the updated post on <a href="../../../../../blog/2013/03/08/pelican-ipython-notebook-plugin/">blogging with iPython notebook and pelican with a plugin</a>.</p>
        </div>
    </article>

    <div class="metadata">
        <ul>
            <li>
                <strong>Published:</strong>
                <i><time datetime="2013-02-16T00:00:00">February 16, 2013</time></i>
            </li>
            <li>
                <strong>In:</strong>
                <a href="../../../../../category/blogging.html">Blogging</a>
            </li>
                        <li>
                <strong>Tags:</strong>
                <a href="../../../../../tag/python.html">python</a> 
                <a href="../../../../../tag/pelican.html">pelican</a> 
                            </li>
                        <li>
                <strong>Written by:</strong>
                <a href="../../../../../author/daniel-rodriguez.html">Daniel Rodriguez</a>
            </li>
        </ul>
    </div>
</div>
</div>

<footer>
<section class='footer'>
    <div class="post social container row-fluid">
        <div class="span3">
            <div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false"></div>
        </div>
        <div class="span3">
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="danielfrg">Tweet</a>
        </div>

        <div class="span3">
            <div class="g-plusone" data-size="medium" data-annotation="bubble"></div>
        </div>

        <div class="span3 hn">
            <span id="hnews"></span>
        </div>
    </div>

    <div id="disqus_thread" class="comments container"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

<script src="/theme/js/social.js"></script>
</footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35523657-2']);
    _gaq.push(['_trackPageview']);

    (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>