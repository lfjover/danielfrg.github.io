---
layout: article
title: Using D3, backbone and torando to visualize a pandas Data Frame
image: /img/posts/2013/2/hist_1/6_select_and_chart.png
code: true
---

After being procrastinating for weeks the learning of [D3.js][d3] and [backbone.js][backbone] I have finally made my first example using both libraries to explore (via histograms) a pandas DataFrame. The reason of the procastination is very simple: I love python to much, because is probably the only language who is great in all areas (that I am interested at least):

* Great web frameworks as [Django](https://www.djangoproject.com) and [Tornado][tornado] - 'fighting' with ruby ([rails](rubyonrails.org))
* Great Data Analysis packages such as [pandas][pandas] - 'fighting' with [R](http://www.r-project.org)
* Great machine-learning libraries such as [scikit-learn](http://scikit-learn.org/)
* Probably not the most successfull but has a good gaming library [pyGame](http://www.pygame.org/)
* Is a great general purpose language - I use it to programm a robot for a NASA competition using a PS3 controller, serial-ports, web-server, cameras, and all in one language
* And the list could go for hours

For me that is the python killer feature: do **anything** on one language, sometimes the community is not big enough and is necessary the help of a genious like [Wes Mckinney](http://wesmckinney.com) to create [pandas][pandas] but in general the community is great.

The Javascript community is in a similar condition everyday new libraries come up and change how people do stuff, such as [D3.js][d3] changed how people do interactive visualizations.

So I finally got out of my python confort some and re-learn Javascript, I had used it but was very simple examples using JQuery and a very long time ago, everything has changed now the cool people use Backbone.js which is a **fabulous** creation to give structure to Javascript. So I read a lot of begginer tutorials of backbone and D3 and this is the result.

## What I wanted

For [copper][copper], my python data analysis library, I use matplotlib to plot histograms like this:

![Matplotlib Histogram](/img/posts/2013/2/hist_1/matplotlib.png "Matplotlib histogram")

The histograms work and are great so I wanted to do the same with D3.js to explore a `csv` file using pandas.

Data - I am using data from a Business Intelligence project I am currently working on, available here: [expedia.csv](https://raw.github.com/danielfrg/copper/master/tests/data/expedia/train.csv)

## Python: REST API

To use backbone is necessary to have a RESTful API, I select [Tornado][tornado] and [pandas][pandas] to do that I was tempted to use [node](http://nodejs.org/) but at the end of the day I want to keep adding features to [copper][copper] my data analysis package. The API is the following:

* `/columns` returns a list of the columns of the `csv` file
* `/hist/{id}` return necessary data of the columns `id` to create the histogram

Some relevant code:

{% highlight python linenos=table %}
class HistogramHandler(tornado.web.RequestHandler):
    def get(self, col_id):
        df = pd.read_csv('explore.csv')
        col = df[df.columns[int(col_id)]]
        nans = int(len(col) - col.count())
        col = col.dropna()

        ans = {}
        ans['col_name'] = col.name
        ans['nans'] = nans
        ans['values'] = col.values.tolist()
        self.write(json.dumps(ans))

application = tornado.web.Application([
    (r"/", MainHandler),
    (r"/hist/([0-9]+)", HistogramHandler),
    (r"/columns", ColumnsHandler),
], debug=True, **settings)
{% endhighlight %}

calling `/columns` returns this:
{% highlight json linenos=table %}
[{"id": 0, "name": "x1"}, {"id": 1, "name": "x2"}, ... , {"id": 39, "name": "x40"}, {"id": 40, "name": "depend"}]
{% endhighlight %}

calling `/hist/2` returns this:

{% highlight json linenos=table %}
{"col_name": "x3", "values": [3.0, 4.0, 4.0, ... , 2.0, 4.0], "nans": 102}
{% endhighlight %}

## Javascript: UI + Graphics

For backbone I mainly [this article on cascading selects](http://blog.shinetech.com/2011/07/25/cascading-select-boxes-with-backbone-js/). But I use only one select (for not) and use the [underscore](http://underscorejs.org/) templates.

To make the `<select>'s`it good looking I am using a js library called [chosen](http://harvesthq.github.com/chosen/) which is really good and simple to use.

For D3 I follow the [main histogram example](http://bl.ocks.org/3048450) and added a red column to show missing values and hard-code it a little bit more to make changes easier.

## Conclusion

It was hard for me to use javascript again. Learning backbone was even harder but I think I am finally undestanding it, defenitly the best way is to learn it is to take baby steps and read a lot. D3 wasnt that hard, is a very good library.

I include the whole code on [copper][copper] (my data analysis package) which is not yet available via pip, so to use need to download the `explore` folder of the package and run `python explore.py`. Remember to change the `explore.csv` to explore other data.

[tornado]:http://www.tornadoweb.org
[d3]:http://d3js.org
[backbone]:http://backbonejs.org
[pandas]:http://pandas.pydata.org/
[copper]:https://github.com/danielfrg/copper
